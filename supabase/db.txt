-- This script sets up the 'content' table and its access policies for the MovieFlix app.
-- Run this entire script in your Supabase project's SQL Editor.

-- 1. Create the table for storing movie and web series content.
CREATE TABLE public.content (
  id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  content_type text NOT NULL,
  title text NOT NULL,
  description text NOT NULL,
  poster_url text NOT NULL,
  release_date text NOT NULL,
  quality text NOT NULL,
  genres text[] NOT NULL,
  download_sections jsonb,
  CONSTRAINT content_pkey PRIMARY KEY (id)
);

-- 2. Enable Row Level Security (RLS) on the table.
-- RLS is a security feature that controls which rows users can access.
-- By default, no one can access the table until policies are created.
ALTER TABLE public.content ENABLE ROW LEVEL SECURITY;

-- 3. Create a policy to allow public, anonymous read access to the content.
-- This allows anyone visiting the website to see the movie/series list.
CREATE POLICY "Allow public read access" ON public.content
FOR SELECT USING (true);

-- 4. Create a policy to allow anonymous users to perform all actions.
-- This is for the public-facing Admin Panel to function.
-- For a production application, you would restrict INSERT, UPDATE, DELETE
-- to authenticated users with specific roles (e.g., 'admin').
CREATE POLICY "Allow anon users to perform all actions" ON public.content
FOR ALL
TO anon
USING (true)
WITH CHECK (true);
